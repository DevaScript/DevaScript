#!/usr/bin/env node
!function(){"use strict";function e(e,n){for(var t=n-e.length,o=0;o<t;o++)e=" "+e;return e}var n=require("fs"),t=require("path"),o=require("https"),a=require("child_process").exec,r=/<\w+>/g,i=/(?:^|\s)(?:\[\w+\]|--?\w+)/g,c={version:{usage:"ravena version",description:"output Ravena CLI version"},help:{usage:"ravena help <command>",description:"output help message for command",parameters:{"<command>":"name of Ravena CLI command"}},create:{usage:"ravena create <name> [options]",description:"create application in new directory",parameters:{"<name>":"name of application and directory"},options:{"-t, --template <username>/<repository>":"GitHub repository to use as template"}}};function s(e,n){console.log("\x1b[34m"+e+"\x1b[0m "+n)}function d(e){console.log(e.replace(r,"\x1b[33m$&\x1b[0m").replace(i,"\x1b[36m$&\x1b[0m"))}function l(e){console.log("\x1b[31merror\x1b[0m "+e)}function m(n){var t="",o="",a=0;for(var r in n){var i=r.length;i>a&&(a=i)}for(var c in n){var s=n[c];t+=o+"\t"+c+e(s,a-c.length+s.length+3),o="\n"}return t}function p(e,n,t){var o=e.indexOf(n);if(-1===o)return e;var a=e.slice(0,o),r=p(e.slice(o+n.length),n,t),i=Buffer.from(t);return Buffer.concat([a,i,r],a.length+i.length+r.length)}for(var u=2===process.argv.length?["help"]:process.argv.slice(2),v=u[0],f=[],h={},g=1;g<u.length;g++){var T=u[g];if("-"===T[0])for(;g<u.length;g++){var x=u[g];"-"===x[0]?h[x]=!0:h[u[g-1]]=x}else f.push(T)}switch(v){case"version":d("Ravena CLI v1.0.0");break;case"help":var w=f[0];if(w in c){var k=c[w];d("Usage: "+k.usage+"\n\t"+k.description),"parameters"in k&&d("\nParameters:\n"+m(k.parameters)),"options"in k&&d("\nOptions:\n"+m(k.options))}else{var R={};for(var y in c){var A=c[y];R[A.usage]=A.description}d("Usage: ravena <command> [options]\n\nCommands:\n"+m(R))}break;case"create":var E=f[0],H=h["-t"]||h["--template"]||"midnightravena/Ravena-template";void 0!==E&&0!==E.length||l("Invalid or unknown name.\n\nAttempted to create an application.\n\nReceived an invalid or unknown name.\n\nExpected a valid name. Run \x1b[35mravena help create\x1b[0m to see usage information."),!0===H&&l("अमान्य अथवा अज्ञात टेम्पलेट।\n\nअनुप्रयोगं निर्मातुं प्रयत्नः कृतः।\n\nअमान्यं अज्ञातं वा टेम्पलेट् प्राप्तम् ।\n\nवैध टेम्पलेट् अपेक्षितम्। धावनं करोतु \x1b[35mravena help create\x1b[0m उपयोगसूचना द्रष्टुं ।"),s("Ravena","creating application"),function(e,r){var i={method:"GET",host:"api.github.com",path:"/repos/"+r+"/tarball/master",headers:{"User-Agent":"Ravena"}};o.get(i,(function(c){302===c.statusCode?o.get(c.headers.location,(function(o){if(200===o.statusCode){var i=t.join(__dirname,"ravena-template.tar.gz"),d=n.createWriteStream(i);o.on("data",(function(e){d.write(e)})),o.on("end",(function(){d.end(),s("downloaded",r),function(e,o){var r=t.join(process.cwd(),e);a("mkdir "+r,(function(i){null!==i&&l("\nनिर्देशिकानिर्माणं विफलम् ।\n\nनिर्देशिकां निर्मातुं प्रयत्नः कृतः\n\t" + targetPath + "\n\nप्राप्तदोषः\n\t" + error + "\n\nअपेक्षितं सफलं निर्देशिकानिर्माणम्।"),a("tar -xzf "+o+" -C "+r+" --strip=1",(function(a){null!==a&&l("अभिलेखनिष्कासनं विफलम्।\n\nलक्ष्यं प्रति संग्रहं निष्कासयितुं प्रयत्नः कृतः\n\t" + archivePath + " -> " + targetPath + "\n\nप्राप्तदोषः\n\t" + error + "\n\nअपेक्षितं सफलं अभिलेखनिष्कासनम्।"),s("installed",r),function(e,o,a){n.unlink(o,(function(r){null!==r&&l("संग्रहविलोपनं विफलम्।\n\nसंग्रहं विलोपयितुं प्रयत्नः कृतः\n\t" + archivePath + "\n\nप्राप्तदोषः\n\t" + error + "\n\nअपेक्षितं सफलं संग्रहविलोपनम्।"),s("cleaned",o),function e(o,a,r){for(var i=n.readdirSync(a),c=0;c<i.length;c++){var d=i[c],l=t.join(a,d);n.statSync(l).isDirectory()?e(o,l,r):(n.writeFileSync(l,p(n.readFileSync(l),"{# RavenaName #}",o)),s("processed",t.relative(r,l)))}}(e,a,a),s("created","application \x1b[36m"+e+"\x1b[0m\n\nआरम्भार्थं धावन्तु\n\tcd "+e+"\n\tnpm install\n\tnpm run dev")}))}(e,o,r)}))}))}(e,i)}))}else l("अमान्य डाउनलोड HTTP प्रतिक्रिया।\n\nटेम्पलेट् डाउनलोड् कर्तुं प्रयत्नः कृतः\n\t"+c.headers.location+"\n\nप्राप्तः त्रुटि HTTP स्थितिसङ्केतः\n\t"+o.statusCode+"\n\nअपेक्षितः ठीकः HTTP स्थितिसङ्केतः 200 ।")})).on("error",(function(e){l("HTTP अनुरोधं डाउनलोड् कर्तुं असफलम्।\n\nटेम्पलेट् डाउनलोड् कर्तुं प्रयतितम्\n\t"+c.headers.location+"\n\nप्राप्तदोषः\n\t"+e+"\n\nअपेक्षितः सफलः HTTP अनुरोधः।")})):l("अमान्य संग्रहलिङ्क HTTP प्रतिक्रिया।\n\nटेम्पलेट् कृते आर्काइव् लिङ्क् आनेतुं प्रयत्नः कृतः\n\thttps://"+i.host+i.path+"\n\nप्राप्तः त्रुटिः HTTP स्थितिसङ्केतः\n\t"+c.statusCode+"\n\nअपेक्षितं HTTP स्थितिसङ्केतः 302 प्राप्तम्।")})).on("error",(function(e){l("संग्रहणलिङ्क HTTP अनुरोधः विफलः।\n\nटेम्पलेट् कृते आर्काइव् लिङ्क् आनेतुं प्रयत्नः कृतः\n\thttps://"+i.host+i.path+"\n\nप्राप्तदोषः\n\t"+e+"\n\nअपेक्षितः सफलः HTTP अनुरोधः।")}))}(E,H);break;default:l("अप्रसिद्धादेशः ।\n\nआदेशं निष्पादयितुं प्रयत्नः कृतः ।\n\nन विद्यमानः आदेशः प्राप्तः\n\t"+v+"\n\nवैधः आदेशः अपेक्षितः । धावनं करोतु \x1b[35mravena help\x1b[0m वैध आदेशान् द्रष्टुं ।")}}();
